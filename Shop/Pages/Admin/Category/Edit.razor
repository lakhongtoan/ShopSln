@page "/admin/categories/edit/{id:int}"
@using Microsoft.AspNetCore.Components.Forms
@using Shop.Models
@using Microsoft.EntityFrameworkCore
@inject AppDbContext Db
@inject NavigationManager Nav

<h3 class="fw-bold mb-4">Chỉnh sửa danh mục</h3>

@if (Category == null)
{
    <p><em>Đang tải...</em></p>
}
else
{
    <EditForm Model="Category" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label>Tên danh mục</label>
            <InputText class="form-control" @bind-Value="Category.Name" />
        </div>

        <div class="mb-3">
            <label>Mô tả</label>
            <InputTextArea class="form-control" @bind-Value="Category.Description" Rows="3" />
        </div>

        <div class="form-check mb-3">
            <InputCheckbox class="form-check-input" @bind-Value="Category.IsActive" />
            <label class="form-check-label">Kích hoạt</label>
        </div>

        <button type="submit" class="btn btn-primary">💾 Cập nhật</button>
        <button type="button" class="btn btn-secondary" @onclick="OnCancel">Quay lại</button>
    </EditForm>
}

@code {
    [Parameter] public int id { get; set; }
    private Category? Category;

    protected override async Task OnInitializedAsync()
    {
        Category = await Db.Categories.FirstOrDefaultAsync(c => c.CategoryId == id);
    }

    private async Task HandleSubmit()
    {
        if (Category == null) return;

        Db.Categories.Update(Category);
        await Db.SaveChangesAsync();
        Nav.NavigateTo("/admin/categories");
    }

    private void OnCancel() => Nav.NavigateTo("/admin/categories");
}
