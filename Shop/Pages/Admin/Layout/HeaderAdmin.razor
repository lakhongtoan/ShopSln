﻿@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider

<header class="container-fluid bg-light">
    <div class="row align-items-center bg-info bg-opacity-10">
        <div class="col-12 col-md-2">
            <div class="d-flex align-items-center justify-content-center justify-content-md-start">
                <a class="h2 mb-0 mt-2 me-2" href="/" style="text-decoration: none;">Shop Camping</a>
            </div>
        </div>

        <div class="col-md-10 col-12 bg-gradient-header d-flex flex-wrap align-items-center p-4">
            <button class="btn btn-outline-secondary d-md-none me-3" type="button"
                    data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar"
                    style="font-size: 1.2rem; padding: 0.5rem 0.75rem;">
                <i class="fa fa-bars"></i>
            </button>

            <h3 class="mb-0 me-auto fw-bold" style="font-size: 1.75rem;">Admin Manager</h3>

            <div class="dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" 
                   data-bs-toggle="dropdown"
                   style="font-size: 1.1rem; padding: 0.5rem 1rem; cursor: pointer;">
                    @* <img src="images/iconlogo/admin.png" class="rounded-circle me-2" width="40" height="40" /> *@
                    @if (!string.IsNullOrEmpty(AdminName))
                    {
                        <div><h5 class="mb-0 fw-bold">@AdminName</h5></div>
                    }
                </a>
                <ul class="dropdown-menu dropdown-menu-end" style="min-width: 220px;">
                    <li>
                        <a href="#" class="dropdown-item fw-bold"
                           style="font-size: 1rem; padding: 0.75rem 1rem;"
                           @onclick="GoToProfile"
                           @onclick:preventDefault>
                            <i class="fa-solid fa-id-card me-2" style="font-size: 1.1rem;"></i> Thông tin Admin
                        </a>
                    </li>
                    <li>
                        <a href="#" class="dropdown-item fw-bold"
                           style="font-size: 1rem; padding: 0.75rem 1rem;"
                           @onclick="Logout"
                           @onclick:preventDefault>
                            <i class="fa-solid fa-right-from-bracket me-2" style="font-size: 1.1rem;"></i> Đăng xuất
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</header>

@code {
    [Parameter] public string? PageTitle { get; set; }
    private string? AdminName;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity is not null && user.Identity.IsAuthenticated)
        {
            AdminName = user.Identity.Name;
        }
    }

    private void GoToProfile() => Navigation.NavigateTo("/admin/profile");

    private void Logout()
    {
        // Navigate đến endpoint logout của controller
        Navigation.NavigateTo("/Account/Logout", forceLoad: true);
    }
}