@model Shop.Models.Product
@{
    ViewData["Title"] = "Product Details";
    var relatedProducts = ViewBag.RelatedProducts as List<Shop.Models.Product>;
}

<section id="product-details" style="margin-top:40px;">
    <div class="container">
        <!-- ==== HÀNG CHÍNH ==== -->
        <div class="row">
            <!-- ==== ẢNH SẢN PHẨM ==== -->
            <div class="col-md-5">
                <div class="view-product text-center">
                    <img src="@(Model.Image ?? "~/images/home/anh.jpg")"
                         alt="@Model.Name"
                         class="img-fluid rounded shadow-sm"
                         style="max-height:400px; object-fit:cover;">
                </div>
            </div>

            <!-- ==== THÔNG TIN CHI TIẾT ==== -->
            <div class="col-md-7">
                <div class="product-information p-3 bg-white rounded shadow-sm">
                    <h2 class="fw-bold text-dark">@Model.Name</h2>
                    <p class="text-muted mb-1">Mã sản phẩm: @Model.ProductID</p>
                    <h3 class="text-warning fw-bold">$@Model.Price</h3>

                    <p><b>Trạng thái:</b>
                        @if (Model.StockQuantity > 0)
                        {
                            <span class="text-success">Còn hàng</span>
                        }
                        else
                        {
                            <span class="text-danger">Hết hàng</span>
                        }
                    </p>

                    <p><b>Danh mục:</b> @Model.Category?.Name</p>
                    <p><b>Thương hiệu:</b> @Model.Brand?.Name</p>

                    <div class="mt-3 d-flex align-items-center gap-3">
                        <label for="quantity">Số lượng:</label>
                        <input id="quantity" type="number" value="1" min="1"
                               class="form-control" style="width:80px; text-align:center;">
                    </div>

                    <div class="mt-3">
                            <button type="button"
                                    class="btn fw-semibold add-to-cart"
                                    data-product-id="@Model.ProductID"
                                    style="background-color:#ff8c00; color:#fff; border:none; padding:10px 20px; border-radius:6px;">
                                <i class="fa fa-shopping-cart"></i> Thêm vào giỏ hàng
                            </button>
                        </div>
                    <div class="mt-3">
                        <p class="fw-bold mb-1">Mô tả sản phẩm:</p>
                        <p class="text-secondary">@Model.Description</p>
                    </div>
                </div>
            </div>
        </div> <!-- ✅ Đóng hàng chi tiết sản phẩm ở đây -->

        <!-- ==== SẢN PHẨM LIÊN QUAN ==== -->
        @if (relatedProducts != null && relatedProducts.Any())
        {
            <div class="related-products mt-5">
                <h3 class="text-center mb-4 fw-bold text-dark">Sản phẩm liên quan</h3>
                <div class="row justify-content-center">
                    @foreach (var p in relatedProducts.Take(4))
                    {
                        <div class="col-md-3 col-sm-6 mb-4">
                            <div class="card h-100 shadow-sm border-0">
                                <img src="@(p.Image ?? "~/images/home/anh.jpg")"
                                     class="card-img-top"
                                     style="height:200px; object-fit:cover;" alt="@p.Name">
                                <div class="card-body text-center">
                                    <h6 class="card-title">@p.Name</h6>
                                    <p class="fw-bold text-warning mb-2">$@p.Price</p>
                                    <a asp-controller="Shop" asp-action="Details" asp-route-id="@p.ProductID"
                                       class="btn btn-outline-warning btn-sm">Xem chi tiết</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.add-to-cart').click(function (e) {
                e.preventDefault();
                var productId = $(this).data('product-id');
                var quantity = parseInt($('#quantity').val()) || 1;

                $.ajax({
                    url: '@Url.Action("AddToCart", "Shop")',
                    type: 'POST',
                    data: { productId: productId, quantity: quantity },
                    success: function (response) {
                        if (response.success) {
                            $('.cart-count').text(response.cartCount);
                            alert('Đã thêm sản phẩm vào giỏ hàng!');
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function () {
                        alert('Lỗi khi thêm vào giỏ hàng');
                    }
                });
            });
        });
    </script>
}

<style>
/* ==== STYLE CHI TIẾT SẢN PHẨM ==== */
#product-details {
    background-color: #f9f9f9;
    padding: 30px 0;
}

.product-information {
    line-height: 1.6;
}

.related-products {
    margin-top: 50px;
}

.related-products .card {
    border: none;
    transition: 0.3s;
    border-radius: 10px;
}

.related-products .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
</style>
